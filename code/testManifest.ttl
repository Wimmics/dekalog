@prefix mf: <http://www.w3.org/2001/sw/DataAccess/tests/test-manifest#> .
@prefix sd: <http://www.w3.org/ns/sparql-service-description#> .
@prefix dkg: <http://ns.inria.fr/kgindex#> .
@prefix earl: <http://www.w3.org/ns/earl#> .
@prefix prov: <http://www.w3.org/ns/prov#> .
@prefix kgi: <http://ns.inria.fr/kgindex#>
@prefix void: <http://rdfs.org/ns/void#> .

<> a mf:Manifest ;
    mf:entries (
            <file:///user/pmaillot/home/git/dekalog/rules/check/SPARQLESFilRegex.ttl>
            <file:///user/pmaillot/home/git/dekalog/rules/check/SPARQLESSelEmpty.ttl>
            <file:///user/pmaillot/home/git/dekalog/rules/check/SPARQLESSelFilBool.ttl>
            <file:///user/pmaillot/home/git/dekalog/rules/check/SPARQLESSelDist.ttl>
            <file:///user/pmaillot/home/git/dekalog/rules/check/SPARQLESConOpt.ttl>
            <file:///user/pmaillot/home/git/dekalog/rules/check/SPARQLESCon.ttl>
        ) .

<file:///user/pmaillot/home/git/dekalog/rules/check/SPARQLESConOpt.ttl> a mf:ManifestEntry ;
   kgi:onSuccess (
        [
            mf:action """
            PREFIX sd: <http://www.w3.org/ns/sparql-service-description#>
            PREFIX lsq: <http://lsq.aksw.org/vocab#>
            CONSTRUCT {
                $endpointDescription sd:endpoint $endpoint ;
                    sd:feature lsq:Optional .
            } WHERE {
            }"""
        ]
   ) .

<file:///user/pmaillot/home/git/dekalog/rules/check/SPARQLESFilRegex.ttl> a mf:ManifestEntry ;
    kgi:onSuccess (
        [
            mf:action """
            PREFIX sd: <http://www.w3.org/ns/sparql-service-description#>
            PREFIX lsq: <http://lsq.aksw.org/vocab#>
            CONSTRUCT {
                $endpointDescription sd:endpoint $endpoint ;
                    sd:feature lsq:Regex .
            } WHERE {
            }
            """
        ]
    ) .

<file:///user/pmaillot/home/git/dekalog/rules/check/SPARQLESSelFilBool.ttl> a mf:ManifestEntry ;
    kgi:onSuccess (
        [
            mf:action """
            PREFIX sd: <http://www.w3.org/ns/sparql-service-description#>
            PREFIX kgi: <http://ns.inria.fr/kgindex#>
            PREFIX lsq: <http://lsq.aksw.org/vocab#>
            CONSTRUCT {
                $endpointDescription sd:endpoint $endpoint ;
                    sd:feature kgi:BooleanInPattern .
            } WHERE {
            }
            """
        ]
    ) .

<file:///user/pmaillot/home/git/dekalog/code/LDScriptRule.ttl> a mf:ManifestEntry ;
    kgi:onSuccess (
        [ mf:action """PREFIX void: <http://rdfs.org/ns/void#>
            PREFIX prov: <http://www.w3.org/ns/prov#>
            PREFIX earl: <http://www.w3.org/ns/earl#>
            PREFIX kgi: <http://ns.inria.fr/kgindex#>
            CONSTRUCT {
            $metadataDescription a prov:Entity , earl:TestSubject ;
                prov:wasDerivedFrom $endpoint ;
                kgi:curated $datasetDescription .
            $datasetDescription void:vocabulary ?ns .
        }
        WHERE {
            ?s a ?elem .
            BIND( IRI(REPLACE( str(?elem), "(#|/)[^#/]*$", "$1" )) AS ?ns ) .
        }
        """ ]
        [ mf:action """PREFIX void: <http://rdfs.org/ns/void#>
            PREFIX prov: <http://www.w3.org/ns/prov#>
            PREFIX earl: <http://www.w3.org/ns/earl#>
            PREFIX kgi: <http://ns.inria.fr/kgindex#>
            CONSTRUCT {
                $metadataDescription a prov:Entity , earl:TestSubject ;
                    prov:wasDerivedFrom $endpoint ;
                    kgi:curated $datasetDescription .
                $datasetDescription void:vocabulary ?ns .
            }
            WHERE {
                ?s ?elem ?o .
                BIND( IRI(REPLACE( str(?elem), "(#|/)[^#/]*$", "$1" )) AS ?ns ) .
            }
        """ ]
    ) ;
    kgi:onFailure (
        [ mf:entries (
                <https://raw.githubusercontent.com/Wimmics/dekalog/master/rules/extraction/vocabularyListCorese.ttl>
            ) ]
        [ mf:action """PREFIX void: <http://rdfs.org/ns/void#>
            PREFIX prov: <http://www.w3.org/ns/prov#>
            PREFIX earl: <http://www.w3.org/ns/earl#>
            PREFIX kgi: <http://ns.inria.fr/kgindex#>
            CONSTRUCT {
                $metadataDescription kgi:test "TESTTESTTEST"
            }
            WHERE {
            }
        """ ]
    ) .

<https://raw.githubusercontent.com/Wimmics/dekalog/master/rules/extraction/vocabularyListCorese.ttl> a mf:ManifestEntry ;
    kgi:endpoint <http://localhost:8080/sparql> ;
        kgi:onSuccess (
            [ mf:action """PREFIX void: <http://rdfs.org/ns/void#>
            PREFIX prov: <http://www.w3.org/ns/prov#>
            PREFIX earl: <http://www.w3.org/ns/earl#>
            PREFIX kgi: <http://ns.inria.fr/kgindex#>
            CONSTRUCT {
            $metadataDescription a prov:Entity , earl:TestSubject ;
                prov:wasDerivedFrom $endpoint ;
                kgi:curated $datasetDescription .
            $datasetDescription void:vocabulary ?ns .
        }
        WHERE {
            SERVICE $endpoint {
                SELECT DISTINCT ?elem WHERE {
                    ?s a ?elem .
                }
            }
            BIND( IRI(REPLACE( str(?elem), "(#|/)[^#/]*$", "$1" )) AS ?ns ) .
        }
        """ ]
        [ mf:action """PREFIX void: <http://rdfs.org/ns/void#>
            PREFIX prov: <http://www.w3.org/ns/prov#>
            PREFIX earl: <http://www.w3.org/ns/earl#>
            PREFIX kgi: <http://ns.inria.fr/kgindex#>
            CONSTRUCT {
            $metadataDescription a prov:Entity , earl:TestSubject ;
                prov:wasDerivedFrom $endpoint ;
                kgi:curated $datasetDescription .
            $datasetDescription void:vocabulary ?ns .
        }
        WHERE {
            SERVICE $endpoint {
                SELECT DISTINCT ?elem WHERE {
                    ?s ?elem ?o .
                }
            }
            BIND( IRI(REPLACE( str(?elem), "(#|/)[^#/]*$", "$1" )) AS ?ns ) .
        }
        """ ]
    ) .
