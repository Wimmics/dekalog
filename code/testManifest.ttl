@prefix mf: <http://www.w3.org/2001/sw/DataAccess/tests/test-manifest#> .
@prefix sd: <http://www.w3.org/ns/sparql-service-description#> .
@prefix dkg: <http://ns.inria.fr/kg/index#> .
@prefix earl: <http://www.w3.org/ns/earl#> .
@prefix prov: <http://www.w3.org/ns/prov#> .
@prefix kgi: <http://ns.inria.fr/kg/index#>
@prefix void: <http://rdfs.org/ns/void#> .

<> a mf:Manifest ;
<<<<<<< Updated upstream
    mf:entries (
            <file:///user/pmaillot/home/git/dekalog/rules/extraction/vocabularyListCoreseLOV.ttl>
            <file:///user/pmaillot/home/git/dekalog/rules/extraction/endpointDescResource.ttl>
            <file:///user/pmaillot/home/git/dekalog/rules/extraction/datasetDescResource.ttl>
            <file:///user/pmaillot/home/git/dekalog/rules/extraction/languages.ttl>
        ) .

<file:///user/pmaillot/home/git/dekalog/rules/extraction/languages.ttl> a mf:ManifestEntry ;
    kgi:onSuccess (
        [
            mf:action """PREFIX schema: <http://schema.org/>
                CONSTRUCT {
                    $datasetDescription schema:availableLanguage ?lang .
                }
                WHERE {
                    SELECT DISTINCT (lang(?o) as ?lang)  WHERE {
                        ?s ?p ?o
                        FILTER( isLiteral(?o) )
                    }
                }
            """
        ]
    ) .

<file:///user/pmaillot/home/git/dekalog/rules/extraction/endpointDescResource.ttl> a mf:ManifestEntry ;
    kgi:onSuccess (
        [
            mf:action """
                PREFIX dcat: <http://www.w3.org/ns/dcat#>
                PREFIX prov: <http://www.w3.org/ns/prov#>
                PREFIX sd: <http://www.w3.org/ns/sparql-service-description#>
                PREFIX earl: <http://www.w3.org/ns/earl#>
                PREFIX kgi: <http://ns.inria.fr/kg/index#>
                CONSTRUCT {
                    $endpointDescription ?p ?o .
                    $endpointDescription a sd:Service, dcat:DataService , prov:Entity , earl:TestSubject ;
                        sd:endpoint $endpointUrl .
                    $metadataDescription a prov:Entity , earl:TestSubject ;
                         prov:wasDerivedFrom $endpointUrl ;
                         kgi:curated $endpointDescription ;
                         kgi:original ?res .
                    GRAPH $endpointUrl {
                        ?res ?p ?o .
                    }
                } WHERE {
                    ?res sd:endpoint $endpointUrl .
                    ?res ?p ?o .
                }"""
        ]
        [
            mf:action """PREFIX sd: <http://www.w3.org/ns/sparql-service-description#>
                PREFIX kgi: <http://ns.inria.fr/kg/index#>
                CONSTRUCT {
                    ?s ?p $endpointDescription .
                    $metadataDescription kgi:original ?res .
                    GRAPH $endpointUrl {
                        ?s ?p ?res .
                    }
                } WHERE {
                   ?res sd:endpoint $endpointUrl .
                   ?s ?p ?res .
                }"""
        ]
        [
            mf:action """
                PREFIX dcterms: <http://purl.org/dc/terms/>
                DELETE {
                    $metadataDescription dcterms:modified ?mod .
                }
                INSERT {
                    $metadataDescription dcterms:modified $dateLiteral .
                }
                WHERE {
                    $metadataDescription dcterms:modified ?mod .
                }
            """
        ]
            <file:///user/pmaillot/home/git/dekalog/rules/meta/equivalences.ttl>
    ) .

<file:///user/pmaillot/home/git/dekalog/rules/extraction/datasetDescResource.ttl> a mf:ManifestEntry ;
    kgi:onSuccess (
        [ mf:action """PREFIX void: <http://rdfs.org/ns/void#>
                PREFIX dcat: <http://www.w3.org/ns/dcat#>
                PREFIX prov: <http://www.w3.org/ns/prov#>
                PREFIX sd: <http://www.w3.org/ns/sparql-service-description#>
                PREFIX earl: <http://www.w3.org/ns/earl#>
                PREFIX kgi: <http://ns.inria.fr/kg/index#>
                CONSTRUCT {
                    $datasetDescription a dcat:Dataset , void:Dataset , prov:Entity ;
                        ?pp ?o .
                    $metadataDescription a prov:Entity , earl:TestSubject ;
                        prov:wasDerivedFrom $endpointUrl ;
                        kgi:curated $datasetDescription ;
                        kgi:original ?res .
                    GRAPH $endpointUrl {
                        ?res ?pp ?o .
                    }
                }
                WHERE {
                    { ?res a dcat:Dataset }
                    UNION { ?res a void:Dataset }
                    ?res ?p $endpointUrl .
                    ?res ?pp ?o .
                 }"""
        ]
        [
            mf:action """PREFIX void: <http://rdfs.org/ns/void#>
                PREFIX dcat: <http://www.w3.org/ns/dcat#>
                PREFIX prov: <http://www.w3.org/ns/prov#>
                PREFIX sd: <http://www.w3.org/ns/sparql-service-description#>
                PREFIX earl: <http://www.w3.org/ns/earl#>
                PREFIX kgi: <http://ns.inria.fr/kg/index#>
                CONSTRUCT {
                    $metadataDescription a prov:Entity , earl:TestSubject ;
                        prov:wasDerivedFrom $endpointUrl ;
                        kgi:curated $datasetDescription ;
                        kgi:original ?res .
                    $datasetDescription a dcat:Dataset , void:Dataset , prov:Entity .
                    ?s ?pp $datasetDescription .
                    GRAPH $endpointUrl {
                        ?s ?pp ?res .
                    }
                }
                WHERE {
                    { ?res a dcat:Dataset }
                    UNION { ?res a void:Dataset }
                    ?res ?p $endpointUrl .
                    ?s ?pp ?res .
                 }"""
        ]
        [
            mf:action """
                PREFIX dcterms: <http://purl.org/dc/terms/>
                DELETE {
                    $metadataDescription dcterms:modified ?mod .
                }
                INSERT {
                    $metadataDescription dcterms:modified $dateLiteral .
                }
                WHERE {
                    $metadataDescription dcterms:modified ?mod .
                }
            """
        ]
            <file:///user/pmaillot/home/git/dekalog/rules/meta/equivalences.ttl>
        ) .

<file:///user/pmaillot/home/git/dekalog/rules/meta/equivalences.ttl> a mf:ManifestEntry ;
    kgi:onSuccess (
        [ mf:action """PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#> PREFIX skos: <http://www.w3.org/2004/02/skos/core#> INSERT { ?s rdfs:label ?o . } WHERE { ?s skos:prefLabel ?o . } """ ]
        [ mf:action """PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#> PREFIX skos: <http://www.w3.org/2004/02/skos/core#> INSERT { ?s skos:prefLabel ?o . } WHERE { ?s rdfs:label ?o . } """ ]
        [ mf:action """PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#> PREFIX dcterms: <http://purl.org/dc/terms/> INSERT { ?s rdfs:label ?o . } WHERE { ?s dcterms:title ?o . } """ ]
        [ mf:action """PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#> PREFIX dcterms: <http://purl.org/dc/terms/> INSERT { ?s dcterms:title ?o . } WHERE { ?s rdfs:label ?o . } """ ]
        [ mf:action """PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#> PREFIX foaf: <http://xmlns.com/foaf/0.1/> INSERT { ?s rdfs:label ?o . } WHERE { ?s foaf:name ?o . } """ ]
        [ mf:action """PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#> PREFIX foaf: <http://xmlns.com/foaf/0.1/> INSERT { ?s foaf:name ?o . } WHERE { ?s rdfs:label ?o . } """ ]
        [ mf:action """PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#> PREFIX schema: <http://schema.org/> INSERT { ?s rdfs:label ?o . } WHERE { ?s schema:name ?o . } """ ]
        [ mf:action """PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#> PREFIX schema: <http://schema.org/> INSERT { ?s schema:name ?o . } WHERE { ?s rdfs:label ?o . } """ ]
        [ mf:action """PREFIX skos: <http://www.w3.org/2004/02/skos/core#> PREFIX schema: <http://schema.org/> INSERT { ?s skos:prefLabel ?o . } WHERE { ?s schema:name ?o . } """ ]
        [ mf:action """PREFIX skos: <http://www.w3.org/2004/02/skos/core#> PREFIX schema: <http://schema.org/> INSERT { ?s schema:name ?o . } WHERE { ?s skos:prefLabel ?o . } """ ]
        [ mf:action """PREFIX skos: <http://www.w3.org/2004/02/skos/core#> PREFIX dcterms: <http://purl.org/dc/terms/> INSERT { ?s skos:prefLabel ?o . } WHERE { ?s dcterms:title ?o . } """ ]
        [ mf:action """PREFIX skos: <http://www.w3.org/2004/02/skos/core#> PREFIX dcterms: <http://purl.org/dc/terms/> INSERT { ?s dcterms:title ?o . } WHERE { ?s skos:prefLabel ?o . } """ ]
        [ mf:action """PREFIX skos: <http://www.w3.org/2004/02/skos/core#> PREFIX foaf: <http://xmlns.com/foaf/0.1/> INSERT { ?s skos:prefLabel ?o . } WHERE { ?s foaf:name ?o . } """ ]
        [ mf:action """PREFIX skos: <http://www.w3.org/2004/02/skos/core#> PREFIX foaf: <http://xmlns.com/foaf/0.1/> INSERT { ?s foaf:name ?o . } WHERE { ?s skos:prefLabel ?o . } """ ]
        [ mf:action """PREFIX dcterms: <http://purl.org/dc/terms/> PREFIX schema: <http://schema.org/> INSERT { ?s schema:name ?o . } WHERE { ?s dcterms:title ?o . } """ ]
        [ mf:action """PREFIX dcterms: <http://purl.org/dc/terms/> PREFIX schema: <http://schema.org/> INSERT { ?s dcterms:title ?o . } WHERE { ?s schema:name ?o . } """ ]
        [ mf:action """PREFIX schema: <http://schema.org/> PREFIX foaf: <http://xmlns.com/foaf/0.1/> INSERT { ?s schema:name ?o . } WHERE { ?s foaf:name ?o . } """ ]
        [ mf:action """PREFIX schema: <http://schema.org/> PREFIX foaf: <http://xmlns.com/foaf/0.1/> INSERT { ?s foaf:name ?o . } WHERE { ?s schema:name ?o . } """ ]
        [ mf:action """PREFIX dcterms: <http://purl.org/dc/terms/> PREFIX foaf: <http://xmlns.com/foaf/0.1/> INSERT { ?s dcterms:title ?o . } WHERE { ?s foaf:name ?o . } """ ]
        [ mf:action """PREFIX dcterms: <http://purl.org/dc/terms/> PREFIX foaf: <http://xmlns.com/foaf/0.1/> INSERT { ?s foaf:name ?o . } WHERE { ?s dcterms:title ?o . } """ ]
        [ mf:action """PREFIX dcterms: <http://purl.org/dc/terms/> PREFIX schema: <http://schema.org/> INSERT { ?s dcterms:publisher ?o . } WHERE { ?s schema:publisher ?o . } """ ]
        [ mf:action """PREFIX dcterms: <http://purl.org/dc/terms/> PREFIX schema: <http://schema.org/> INSERT { ?s schema:publisher ?o . } WHERE { ?s dcterms:publisher ?o . } """ ]
        [ mf:action """PREFIX dcterms: <http://purl.org/dc/terms/> PREFIX schema: <http://schema.org/> INSERT { ?s dcterms:subject ?o . } WHERE { ?s schema:keywords ?o . } """ ]
        [ mf:action """PREFIX dcterms: <http://purl.org/dc/terms/> PREFIX schema: <http://schema.org/> INSERT { ?s schema:keywords ?o . } WHERE { ?s dcterms:subject ?o . } """ ]
        [ mf:action """PREFIX dcterms: <http://purl.org/dc/terms/> PREFIX schema: <http://schema.org/> INSERT { ?s dcterms:creator ?o . } WHERE { ?s schema:author ?o . } """ ]
        [ mf:action """PREFIX dcterms: <http://purl.org/dc/terms/> PREFIX prov: <http://www.w3.org/ns/prov#> INSERT { ?s dcterms:creator ?o . } WHERE { ?s prov:wasAttributedTo ?o . } """ ]
        [ mf:action """PREFIX dcterms: <http://purl.org/dc/terms/> PREFIX schema: <http://schema.org/> INSERT { ?s schema:author ?o . } WHERE { ?s dcterms:creator ?o . } """ ]
        [ mf:action """PREFIX prov: <http://www.w3.org/ns/prov#> PREFIX schema: <http://schema.org/> INSERT { ?s schema:author ?o . } WHERE { ?s prov:wasAttributedTo ?o . } """ ]
        [ mf:action """PREFIX prov: <http://www.w3.org/ns/prov#> PREFIX dcterms: <http://purl.org/dc/terms/> INSERT { ?s prov:wasAttributedTo ?o . } WHERE { ?s dcterms:creator ?o . } """ ]
        [ mf:action """PREFIX prov: <http://www.w3.org/ns/prov#> PREFIX schema: <http://schema.org/> INSERT { ?s prov:wasAttributedTo ?o . } WHERE { ?s schema:author ?o . } """ ]
        [ mf:action """PREFIX dcterms: <http://purl.org/dc/terms/> PREFIX schema: <http://schema.org/> INSERT { ?s dcterms:licence ?o . } WHERE { ?s schema:licence ?o . } """ ]
        [ mf:action """PREFIX dcterms: <http://purl.org/dc/terms/> PREFIX schema: <http://schema.org/> INSERT { ?s schema:licence ?o . } WHERE { ?s dcterms:licence ?o . } """ ]
        [ mf:action """PREFIX sd: <http://www.w3.org/ns/sparql-service-description#> PREFIX void: <http://rdfs.org/ns/void#> INSERT { $endpointDescription sd:endpoint ?o . } WHERE { $datasetDescription void:sparqlEndpoint ?o . } """ ]
        [ mf:action """PREFIX sd: <http://www.w3.org/ns/sparql-service-description#> PREFIX void: <http://rdfs.org/ns/void#> INSERT { $datasetDescription void:sparqlEndpoint ?o . } WHERE { $endpointDescription sd:endpoint ?o . } """ ]
        [
            mf:action """
                PREFIX dcterms: <http://purl.org/dc/terms/>
                DELETE {
                    $metadataDescription dcterms:modified ?mod .
                }
                INSERT {
                    $metadataDescription dcterms:modified $dateLiteral .
                }
                WHERE {
                    $metadataDescription dcterms:modified ?mod .
                }
            """
        ]
    ) .

<file:///user/pmaillot/home/git/dekalog/rules/extraction/vocabularyListCoreseLOV.ttl> a mf:ManifestEntry ;
        kgi:onSuccess (
            [ kgi:endpoint kgi:federation ;
                mf:action """PREFIX void: <http://rdfs.org/ns/void#>
            PREFIX prov: <http://www.w3.org/ns/prov#>
            PREFIX earl: <http://www.w3.org/ns/earl#>
            PREFIX kgi: <http://ns.inria.fr/kgindex#>
            PREFIX vann: <http://purl.org/vocab/vann/>
            PREFIX voaf: <http://purl.org/vocommons/voaf#>
            PREFIX dcterms: <http://purl.org/dc/terms/>
            CONSTRUCT {
            $metadataDescription a prov:Entity , earl:TestSubject ;
                prov:wasDerivedFrom $endpoint ;
                kgi:curated $datasetDescription .
            $datasetDescription void:vocabulary ?vocabURI .
            GRAPH <https://lov.linkeddata.es/dataset/lov/sparql> {
                ?vocabURI a voaf:Vocabulary ;
                    vann:preferredNamespaceUri ?uri ;
                    vann:preferredNamespacePrefix ?prefix ;
                    dcterms:title ?title .
            }
        }
        WHERE {
            SERVICE $endpoint {
                SELECT DISTINCT ?elem WHERE {
                    ?s a ?elem .
                }
            }
            BIND( IRI(REPLACE( str(?elem), "(#|/)[^#/]*$", "$1" )) AS ?vocabURI ) .
            SERVICE <https://lov.linkeddata.es/dataset/lov/sparql> {
                GRAPH <https://lov.linkeddata.es/dataset/lov>{
                    ?vocabURI a voaf:Vocabulary ;
                        vann:preferredNamespaceUri ?uri ;
                        vann:preferredNamespacePrefix ?prefix ;
                        dcterms:title ?title .
                }
            }
        }
        """ ]
        [ kgi:endpoint kgi:federation ;
            mf:action """PREFIX void: <http://rdfs.org/ns/void#>
            PREFIX prov: <http://www.w3.org/ns/prov#>
            PREFIX earl: <http://www.w3.org/ns/earl#>
            PREFIX kgi: <http://ns.inria.fr/kgindex#>
            PREFIX dcterms: <http://purl.org/dc/terms/>
            CONSTRUCT {
            $metadataDescription a prov:Entity , earl:TestSubject ;
                prov:wasDerivedFrom $endpoint ;
                kgi:curated $datasetDescription .
            $datasetDescription void:vocabulary ?vocabURI .
                ?vocabURI a voaf:Vocabulary ;
                    vann:preferredNamespaceUri ?uri ;
                    vann:preferredNamespacePrefix ?prefix ;
                    dcterms:title ?title .
        }
        WHERE {
            SERVICE $endpoint {
                SELECT DISTINCT ?elem WHERE {
                    ?s ?elem ?o .
                }
            }
            BIND( IRI(REPLACE( str(?elem), "(#|/)[^#/]*$", "$1" )) AS ?vocabURI ) .
            SERVICE <https://lov.linkeddata.es/dataset/lov/sparql> {
                GRAPH <https://lov.linkeddata.es/dataset/lov>{
                    ?vocabURI a voaf:Vocabulary ;
                        vann:preferredNamespaceUri ?uri ;
                        vann:preferredNamespacePrefix ?prefix ;
                        dcterms:title ?title .
                }
            }
        }
        """ ]
    ) .