@prefix mf: <http://www.w3.org/2001/sw/DataAccess/tests/test-manifest#> .
@prefix kgi: <http://ns.inria.fr/kg/index#> .

<> a mf:Manifest ;
    mf:entries (
            <reachability.ttl>
            <provenance.ttl>
            <basicFederatedQuery.ttl>
        ) .

<basicFederatedQuery.ttl> a mf:ManifestEntry ;
    kgi:onSuccess (
        [
            mf:action """
                PREFIX sd: <http://www.w3.org/ns/sparql-service-description#>
                    PREFIX prov: <http://www.w3.org/ns/prov#>
                INSERT DATA {
                    $endpointDescription sd:endpoint $endpointUrl ;
                        sd:feature sd:basicFederatedQuery .
                $metadataDescription prov:wasGeneratedBy <https://raw.githubusercontent.com/Wimmics/dekalog/master/rules/check/basicFederatedQuery.ttl#activity> .
                <https://raw.githubusercontent.com/Wimmics/dekalog/master/rules/check/basicFederatedQuery.ttl#activity> a prov:Activity ;
                    prov:used <https://raw.githubusercontent.com/Wimmics/dekalog/master/rules/check/basicFederatedQuery.ttl> .
                }
            """
        ]
        <../meta/modifiedUpdate.ttl>
    ) .

<reachability.ttl> a mf:ManifestEntry ;
    kgi:onSuccess (
        [ mf:action """PREFIX void: <http://rdfs.org/ns/void#>
            PREFIX dcat: <http://www.w3.org/ns/dcat#>
            PREFIX prov: <http://www.w3.org/ns/prov#>
            PREFIX sd: <http://www.w3.org/ns/sparql-service-description#>
            PREFIX earl: <http://www.w3.org/ns/earl#>
            PREFIX kgi: <http://ns.inria.fr/kg/index#>
            PREFIX dqv: <http://www.w3.org/ns/dqv#>
            PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
            INSERT DATA {
                $datasetDescription a void:Dataset , dcat:Dataset , prov:Entity , earl:TestSubject ;
                    dcat:service $endpointDescription ;
                    dcat:distribution [
                        a dcat:Distribution ;
                        dcat:accessUrl $rawEndpointUrl ;
                        dcat:mediaType "application/sparql-query"
                    ] .
                $endpointDescription sd:endpoint $rawEndpointUrl ;
                    dcat:servesDataset $datasetDescription ;
                    dcat:endpointUrl $rawEndpointUrl ;
                    a sd:Service, dcat:DataService , prov:Entity , earl:TestSubject ;
                    prov:wasGeneratedBy <https://raw.githubusercontent.com/Wimmics/dekalog/master/rules/check/reachability.ttl#activity> .
                <https://raw.githubusercontent.com/Wimmics/dekalog/master/rules/check/reachability.ttl#activity> prov:used <https://raw.githubusercontent.com/Wimmics/dekalog/master/rules/check/reachability.ttl> ;
                    prov:wasAssociatedWith <https://orcid.org/0000-0002-9814-439X>  .
                $metadataDescription a prov:Entity , earl:TestSubject ;
                    prov:wasDerivedFrom $rawEndpointUrl ;
                    kgi:curated $datasetDescription , $endpointDescription ;
                    dqv:hasQualityMeasurement [
                        a dqv:QualityMeasurement ;
                        dqv:computedOn $endpointDescription ;
                        dqv:isMeasurementOf <https://raw.githubusercontent.com/Wimmics/dekalog/master/rules/check/reachability.ttl> ;
                        dqv:value "true"^^xsd:boolean
                    ] .

            }
            """
        ]
        <../meta/modifiedUpdate.ttl>
        <../meta/equivalences.ttl>
    ) ;
    kgi:onFailure (
        [ mf:action """PREFIX void: <http://rdfs.org/ns/void#>
            PREFIX dcat: <http://www.w3.org/ns/dcat#>
            PREFIX prov: <http://www.w3.org/ns/prov#>
            PREFIX sd: <http://www.w3.org/ns/sparql-service-description#>
            PREFIX earl: <http://www.w3.org/ns/earl#>
            PREFIX kgi: <http://ns.inria.fr/kg/index#>
            PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
            PREFIX dqv: <http://www.w3.org/ns/dqv#>
            PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
            INSERT DATA {
                $datasetDescription a void:Dataset , dcat:Dataset , prov:Entity , earl:TestSubject ;
                    dcat:service $endpointDescription ;
                    dcat:distribution [
                        a dcat:Distribution ;
                        dcat:accessUrl $rawEndpointUrl ;
                        dcat:mediaType "application/sparql-query"
                    ] .
                $endpointDescription sd:endpoint $rawEndpointUrl ;
                    dcat:servesDataset $datasetDescription ;
                    dcat:endpointUrl $rawEndpointUrl ;
                    prov:wasGeneratedBy <https://raw.githubusercontent.com/Wimmics/dekalog/master/rules/check/reachability.ttl#activity> ;
                    a sd:Service, dcat:DataService , prov:Entity , earl:TestSubject .
                <https://raw.githubusercontent.com/Wimmics/dekalog/master/rules/check/reachability.ttl#activity> prov:used <https://raw.githubusercontent.com/Wimmics/dekalog/master/rules/check/reachability.ttl> ;
                    prov:wasAssociatedWith <https://orcid.org/0000-0002-9814-439X> .
                $metadataDescription a prov:Entity , earl:TestSubject ;
                    prov:wasDerivedFrom $rawEndpointUrl ;
                    kgi:curated $datasetDescription , $endpointDescription ;
                    dqv:hasQualityMeasurement [
                        a dqv:QualityMeasurement ;
                        rdfs:label "Could not reach the endpoint"@en ;
                        dqv:computedOn $endpointDescription ;
                        dqv:isMeasurementOf <https://raw.githubusercontent.com/Wimmics/dekalog/master/rules/check/reachability.ttl> ;
                        dqv:value "false"^^xsd:boolean
                    ] .

            }
            """
        ]
        <../meta/modifiedUpdate.ttl>
    ) .

<provenance.ttl> a mf:ManifestEntry ;
    kgi:onSuccess (
        [ mf:action """PREFIX dqv: <http://www.w3.org/ns/dqv#>
            PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
            PREFIX kgi: <http://ns.inria.fr/kg/index#>
                PREFIX prov: <http://www.w3.org/ns/prov#>
            PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
            INSERT DATA {
                $metadataDescription prov:wasGeneratedBy <https://raw.githubusercontent.com/Wimmics/dekalog/master/rules/check/provenance.ttl#activity> ;
                    dqv:hasQualityMeasurement [
                            a dqv:QualityMeasurement ;
                            rdfs:label "Provenance information are present in the metadata"@en ;
                            dqv:computedOn $endpointDescription ;
                            dqv:isMeasurementOf <https://raw.githubusercontent.com/Wimmics/dekalog/master/rules/check/provenance.ttl> ;
                            dqv:value "true"^^xsd:boolean
                        ] .
                <https://raw.githubusercontent.com/Wimmics/dekalog/master/rules/check/provenance.ttl#activity> prov:used <https://raw.githubusercontent.com/Wimmics/dekalog/master/rules/check/provenance.ttl> ;
                    prov:wasAssociatedWith <https://orcid.org/0000-0002-9814-439X> .
            }
            """
        ]
        <../meta/modifiedUpdate.ttl>
    ) ;
    kgi:onFailure (
        [ mf:action """PREFIX dqv: <http://www.w3.org/ns/dqv#>
            PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
            PREFIX kgi: <http://ns.inria.fr/kg/index#>
                PREFIX prov: <http://www.w3.org/ns/prov#>
            PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
            INSERT DATA {
                $metadataDescription prov:wasGeneratedBy <https://raw.githubusercontent.com/Wimmics/dekalog/master/rules/check/provenance.ttl#activity> ;
                    dqv:hasQualityMeasurement [
                            a dqv:QualityMeasurement ;
                            rdfs:label "Provenance information are absent from the metadata"@en ;
                            dqv:computedOn $endpointDescription ;
                            dqv:isMeasurementOf <https://raw.githubusercontent.com/Wimmics/dekalog/master/rules/check/provenance.ttl> ;
                            dqv:value "false"^^xsd:boolean
                        ] .
                <https://raw.githubusercontent.com/Wimmics/dekalog/master/rules/check/provenance.ttl#activity> prov:used <https://raw.githubusercontent.com/Wimmics/dekalog/master/rules/check/provenance.ttl> ;
                    prov:wasAssociatedWith <https://orcid.org/0000-0002-9814-439X> .
            }
            """
        ]
        <../meta/modifiedUpdate.ttl>
    ) .
