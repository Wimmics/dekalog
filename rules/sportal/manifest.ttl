@prefix mf: <http://www.w3.org/2001/sw/DataAccess/tests/test-manifest#> .
@prefix sd: <http://www.w3.org/ns/sparql-service-description#> .
@prefix kgi: <http://ns.inria.fr/kg/index#> .
@prefix earl: <http://www.w3.org/ns/earl#> .
@prefix prov: <http://www.w3.org/ns/prov#> .

<> a mf:Manifest ;
    mf:entries  (
            <classPopulation.ttl>
            <sportalDistinctUrisObjects.ttl>
            <sportalDistinctUrisSubjects.ttl>
            <sportalDistinctBlankNodeObjects.ttl>
            <sportalDistinctBlankNodeSubjects.ttl>
            <sportalDistinctBlankNodes.ttl>
            <sportalDistinctIRIReferences.ttl>
            <sportalDistinctRDFNodes.ttl>
            <sportalDistinctLiterals.ttl>
            <sportalClassPartitionClasses.ttl>
            <sportalClassPartitionDistinctObjects.ttl>
            <sportalClassPartitionDistinctSubjects.ttl>
            <sportalClassPartitionProperties.ttl>
            <sportalClassPartitionPropertyPartitionDistinctSubjects.ttl>
            <sportalPropertyPartitionDistinctObject.ttl>
            <sportalPropertyPartitionDistinctSubject.ttl>
        ) .

<classPopulation.ttl> a mf:ManifestEntry ;
    kgi:onSuccess (
        [
            mf:action """PREFIX void: <http://rdfs.org/ns/void#>
                PREFIX prov: <http://www.w3.org/ns/prov#>
                PREFIX earl: <http://www.w3.org/ns/earl#>
                PREFIX kgi: <http://ns.inria.fr/kg/index#>
                CONSTRUCT {
                    $metadataDescription a prov:Entity , earl:TestSubject ;
                        prov:wasDerivedFrom $endpointUrl ;
                        kgi:curated $datasetDescription .
                    $datasetDescription void:classPartition [
                            void:class ?class ;
                            void:entities ?count
                        ]
                }
                WHERE {
                    { SELECT ?class (count(?instance) AS ?count)
                    WHERE {
                        SELECT DISTINCT ?class ?instance $FROM
                        WHERE {
                            ?instance a ?class
                        }
                    } GROUP BY ?class }
                }
            """
        ]
        <../meta/modifiedUpdate.ttl>
    ) .

<sportalDistinctRDFNodes.ttl> a mf:ManifestEntry ;
    kgi:onSuccess (
        [
            mf:action """PREFIX voidex: <http://ldf.fi/void-ext#>
                CONSTRUCT {
                    $datasetDescription voidex:e:distinctRDFNodes ?x
                }
                WHERE {
                    SELECT (COUNT(DISTINCT ?s ) AS ?x) WHERE { ?s ?p ?o FILTER(isIri(?s))}
                }
            """
        ]
        <../meta/modifiedUpdate.ttl>
    ) .

<sportalDistinctUrisObjects.ttl> a mf:ManifestEntry ;
    kgi:onSuccess (
        [
            mf:action """PREFIX voidex: <http://ldf.fi/void-ext#>
                CONSTRUCT {
                    $datasetDescription voidex:distinctIRIReferenceObjects ?x
                }
                WHERE {
                    SELECT (COUNT(DISTINCT ?o ) AS ?x) WHERE {
                    ?s ?p ?o
                    FILTER(isIri(?o))}
                }
            """
        ]
        <../meta/modifiedUpdate.ttl>
    ) .

<sportalDistinctUrisSubjects.ttl> a mf:ManifestEntry ;
    kgi:onSuccess (
        [
            mf:action """PREFIX voidex: <http://ldf.fi/void-ext#>
                CONSTRUCT {
                    $datasetDescription voidex:distinctIRIReferenceSubjects ?x
                }
                WHERE { SELECT (COUNT(DISTINCT ?s) AS ?x) WHERE { ?s ?p ?o FILTER(isIRI(?s))} }
            """
        ]
        <../meta/modifiedUpdate.ttl>
    ) .

<sportalDistinctBlankNodeSubjects.ttl> a mf:ManifestEntry ;
    kgi:onSuccess (
        [
            mf:action """PREFIX voidex: <http://ldf.fi/void-ext#>
                CONSTRUCT {
                    $datasetDescription voidex:distinctBlankNodeSubjects ?x
                }
                WHERE { SELECT (COUNT(DISTINCT ?s) AS ?x) WHERE { ?s ?p ?o FILTER(isBlank(?s))} }
            """
        ]
        <../meta/modifiedUpdate.ttl>
    ) .

<sportalDistinctBlankNodeObjects.ttl> a mf:ManifestEntry ;
    kgi:onSuccess (
        [
            mf:action """PREFIX voidex: <http://ldf.fi/void-ext#>
                CONSTRUCT {
                    $datasetDescription voidex:distinctBlankNodeSubjects ?x
                }
                WHERE { SELECT (COUNT(DISTINCT ?s) AS ?x) WHERE { ?s ?p ?o FILTER(isBlank(?o))} }
            """
        ]
        <../meta/modifiedUpdate.ttl>
    ) .

<sportalDistinctBlankNodeObjects.ttl> a mf:ManifestEntry ;
    kgi:onSuccess (
        [
            mf:action """PREFIX voidex: <http://ldf.fi/void-ext#>
                CONSTRUCT {
                    $datasetDescription voidex:distinctBlankNodeSubjects ?x
                }
                WHERE { SELECT (COUNT(DISTINCT ?s) AS ?x) WHERE { ?s ?p ?o FILTER(isBlank(?o))} }
            """
        ]
        <../meta/modifiedUpdate.ttl>
    ) .

<sportalDistinctBlankNodes.ttl> a mf:ManifestEntry ;
    kgi:onSuccess (
        [
            mf:action """PREFIX voidex: <http://ldf.fi/void-ext#>
            CONSTRUCT { $datasetDescription voidex:distinctBlankNodes ?x }
            WHERE { SELECT (COUNT(DISTINCT ?b ) AS ?x)
            WHERE { { ?s ?p ?b } UNION { ?b ?p ?o } FILTER(isBlank(?b)) } }
            """
        ]
        <../meta/modifiedUpdate.ttl>
    ) .

<sportalDistinctIRIReferences.ttl> a mf:ManifestEntry ;
    kgi:onSuccess (
        [
            mf:action """PREFIX voidex: <http://ldf.fi/void-ext#>
            CONSTRUCT { $datasetDescription voidex:distinctIRIReferences ?x }
            WHERE { SELECT (COUNT(DISTINCT ?u ) AS ?x)
            WHERE { { ?u ?p ?o } UNION { ?s ?u ?o } UNION { ?s ?p ?u } FILTER(isIri(?u)) } }
            """
        ]
        <../meta/modifiedUpdate.ttl>
    ) .

<sportalDistinctLiterals.ttl> a mf:ManifestEntry ;
    kgi:onSuccess (
        [
            mf:action """PREFIX voidex: <http://ldf.fi/void-ext#>
            CONSTRUCT { $datasetDescription voidex:distinctLiterals ?x }
            WHERE { SELECT (COUNT(DISTINCT ?o ) AS ?x) WHERE { ?s ?p ?o FILTER(isLiteral(?o))} }
            """
        ]
        <../meta/modifiedUpdate.ttl>
    ) .

<sportalClassPartition.ttl> a mf:ManifestEntry ;
    kgi:onSuccess (
        <sportalClassPartitionTriples.ttl>
    ) .

<sportalClassPartitionTriples.ttl> a mf:ManifestEntry ;
    kgi:onSuccess (
        [
            mf:action """PREFIX void: <http://rdfs.org/ns/void#>
                PREFIX kgi: <http://ns.inria.fr/kg/index#>
                CONSTRUCT {
                    $datasetDescription void:classPartition [
                            void:class ?c ;
                            void:triples ?x
                        ]
                }
                WHERE {
                    { SELECT (COUNT(?p) AS ?x) ?c WHERE { ?s a ?c ; ?p ?o } GROUP BY ?c }
                }
            """
        ]
        <../meta/modifiedUpdate.ttl>
    ) ;
    kgi:onFailure (
        [
            mf:action """PREFIX prov: <http://www.w3.org/ns/prov#>
            PREFIX earl: <http://www.w3.org/ns/earl#>
            PREFIX kgi: <http://ns.inria.fr/kg/index#>
            PREFIX void: <http://rdfs.org/ns/void#>
                CONSTRUCT {
                    $datasetDescription void:classPartition [
                            void:class ?c
                        ]
                }
                WHERE {
                    { ?s a ?c . }
                }
            """
        ]
        <../meta/modifiedUpdate.ttl>
    ) .

<sportalClassPartitionClasses.ttl> a mf:ManifestEntry ;
    kgi:onSuccess (
        [ mf:action """PREFIX prov: <http://www.w3.org/ns/prov#>
        PREFIX earl: <http://www.w3.org/ns/earl#>
        PREFIX kgi: <http://ns.inria.fr/kg/index#>
        PREFIX void: <http://rdfs.org/ns/void#>
            CONSTRUCT {
                $datasetDescription void:classPartition [
                        void:class ?c ;
                        void:classes ?x
                    ]
            }
            WHERE {
                { SELECT (COUNT(DISTINCT ?d) AS ?x) ?c WHERE { ?s a ?c , ?d } GROUP BY ?c }
            }
        """ ]
        <../meta/modifiedUpdate.ttl>
    ) .

<sportalClassPartitionProperties.ttl> a mf:ManifestEntry ;
    kgi:onSuccess (
        [ mf:action """PREFIX prov: <http://www.w3.org/ns/prov#>
        PREFIX earl: <http://www.w3.org/ns/earl#>
        PREFIX kgi: <http://ns.inria.fr/kg/index#>
        PREFIX void: <http://rdfs.org/ns/void#>
            CONSTRUCT {
                $datasetDescription void:classPartition [
                        void:class ?c ;
                        void:properties ?x
                    ]
            }
            WHERE {
                { SELECT (COUNT(DISTINCT ?p) AS ?x) ?c WHERE { ?s a ?c ; ?p ?o } GROUP BY ?c }
            }
        """ ]
        <../meta/modifiedUpdate.ttl>
    ) .

<sportalClassPartitionDistinctSubjects.ttl> a mf:ManifestEntry ;
    kgi:onSuccess (
        [ mf:action """PREFIX prov: <http://www.w3.org/ns/prov#>
        PREFIX earl: <http://www.w3.org/ns/earl#>
        PREFIX kgi: <http://ns.inria.fr/kg/index#>
        PREFIX void: <http://rdfs.org/ns/void#>
            CONSTRUCT {
                $metadataDescription a prov:Entity , earl:TestSubject ;
                    prov:wasDerivedFrom $endpointUrl ;
                    kgi:curated $datasetDescription .
                $datasetDescription void:classPartition [
                        void:class ?c ;
                        void:distinctSubjects ?x
                    ]
            }
            WHERE {
                { SELECT (COUNT(DISTINCT ?s) AS ?x) ?c WHERE { ?s a ?c } GROUP BY ?c }
            }
        """ ]
        <../meta/modifiedUpdate.ttl>
    ) .

<sportalClassPartitionDistinctObjects.ttl> a mf:ManifestEntry ;
    kgi:onSuccess (
        [ mf:action """PREFIX prov: <http://www.w3.org/ns/prov#>
        PREFIX earl: <http://www.w3.org/ns/earl#>
        PREFIX kgi: <http://ns.inria.fr/kg/index#>
        PREFIX void: <http://rdfs.org/ns/void#>
            CONSTRUCT {
                $metadataDescription a prov:Entity , earl:TestSubject ;
                    prov:wasDerivedFrom $endpointUrl ;
                    kgi:curated $datasetDescription .
                $datasetDescription void:classPartition [
                        void:class ?c ;
                        void:distinctObjects ?x
                    ]
            }
            WHERE {
                { SELECT (COUNT(DISTINCT ?o) AS ?x) ?c WHERE { ?s a ?c ; ?p ?o } GROUP BY ?c }
            }
        """  ]
        <../meta/modifiedUpdate.ttl>
    ) .

<sportalClassPartitionPropertyPartition.ttl> a mf:ManifestEntry ;
    kgi:onSuccess (
        <sportalClassPartitionPropertyPartitionTriples.ttl>
        <sportalClassPartitionPropertyPartitionDistinctSubjects.ttl>
    ) .

<sportalClassPartitionPropertyPartitionTriples.ttl> a mf:ManifestEntry ;
    kgi:onSuccess (
        [ mf:action """PREFIX prov: <http://www.w3.org/ns/prov#>
        PREFIX earl: <http://www.w3.org/ns/earl#>
        PREFIX kgi: <http://ns.inria.fr/kg/index#>
        PREFIX void: <http://rdfs.org/ns/void#>
            CONSTRUCT {
                $metadataDescription a prov:Entity , earl:TestSubject ;
                    prov:wasDerivedFrom $endpointUrl ;
                    kgi:curated $datasetDescription .
                $datasetDescription void:classPartition [
                        void:class ?c ;
                        void:propertyPartition [
                                void:property ?p ;
                                void:triples ?x
                            ]
                    ]
            }
            WHERE {
                { SELECT (COUNT(?o) AS ?x) ?p WHERE { ?s a ?c ; ?p ?o } GROUP BY ?c ?p }
            }
        """  ]
        <../meta/modifiedUpdate.ttl>
    ) ;
    kgi:onFailure (
        [ mf:action """PREFIX prov: <http://www.w3.org/ns/prov#>
        PREFIX earl: <http://www.w3.org/ns/earl#>
        PREFIX kgi: <http://ns.inria.fr/kg/index#>
        PREFIX void: <http://rdfs.org/ns/void#>
            CONSTRUCT {
                $metadataDescription a prov:Entity , earl:TestSubject ;
                    prov:wasDerivedFrom $endpointUrl ;
                    kgi:curated $datasetDescription .
                $datasetDescription void:classPartition [
                        void:class ?c ;
                        void:propertyPartition [
                                void:property ?p
                                    ]
                            ]
            }
            WHERE {
                { ?s a ?c ; ?p ?o }
            }
        """  ]
        <../meta/modifiedUpdate.ttl>
    ) .

<sportalClassPartitionPropertyPartitionDistinctSubjects.ttl> a mf:ManifestEntry ;
    kgi:onSuccess (
        [ mf:action """PREFIX prov: <http://www.w3.org/ns/prov#>
        PREFIX earl: <http://www.w3.org/ns/earl#>
        PREFIX kgi: <http://ns.inria.fr/kg/index#>
        PREFIX void: <http://rdfs.org/ns/void#>
            CONSTRUCT {
                $metadataDescription a prov:Entity , earl:TestSubject ;
                    prov:wasDerivedFrom $endpointUrl ;
                    kgi:curated $datasetDescription .
                $datasetDescription void:classPartition [
                        void:class ?c ;
                        void:propertyPartition [
                                void:property ?p ;
                                void:distinctSubjects ?x
                            ]
                    ]
            }
            WHERE {
                { SELECT (COUNT(DISTINCT ?s) AS ?x) ?c ?p WHERE { ?s a ?c ; ?p ?o } GROUP BY ?c ?p }
            }
        """ ]
        <../meta/modifiedUpdate.ttl>
    ) ;
    kgi:onFailure (
        [ mf:action """PREFIX prov: <http://www.w3.org/ns/prov#>
        PREFIX earl: <http://www.w3.org/ns/earl#>
        PREFIX kgi: <http://ns.inria.fr/kg/index#>
        PREFIX void: <http://rdfs.org/ns/void#>
            CONSTRUCT {
                $metadataDescription a prov:Entity , earl:TestSubject ;
                    prov:wasDerivedFrom $endpointUrl ;
                    kgi:curated $datasetDescription .
                $datasetDescription void:classPartition [
                        void:class ?c ;
                        void:propertyPartition [
                                void:property ?p
                            ]
                    ]
            }
            WHERE {
                { ?s a ?c ; ?p ?o . }
            }
        """  ]
        <../meta/modifiedUpdate.ttl>
    ) .

<sportalPropertyPartition.ttl> a mf:ManifestEntry ;
    kgi:onSuccess (
        <sportalPropertyPartitionTriples.ttl>
    ) .

<sportalPropertyPartitionTriples.ttl> a mf:ManifestEntry ;
    kgi:onSuccess (
        [
            mf:action """PREFIX void: <http://rdfs.org/ns/void#>
            PREFIX kgi: <http://ns.inria.fr/kg/index#>
            CONSTRUCT {
                $datasetDescription void:propertyPartition [
                        void:property ?p ;
                        void:triples ?x
                    ]
            }
            WHERE {
                { SELECT (COUNT(?o) AS ?x) ?p WHERE { ?s ?p ?o } GROUP BY ?p }
            }"""
        ]
        <../meta/modifiedUpdate.ttl>
    ) ;
    kgi:onFailure (
        [
            mf:action """PREFIX void: <http://rdfs.org/ns/void#>
            PREFIX kgi: <http://ns.inria.fr/kg/index#>
            CONSTRUCT {
                $datasetDescription void:propertyPartition [
                        void:property ?p
                    ]
            }
            WHERE {
                { SELECT DISTINCT ?p WHERE { ?s ?p ?o } }
            }"""
        ]
            <../meta/modifiedUpdate.ttl>
    ) .

<sportalPropertyPartitionDistinctSubject.ttl> a mf:ManifestEntry ;
    kgi:onSuccess (
        [
            mf:action """PREFIX void: <http://rdfs.org/ns/void#>
            PREFIX kgi: <http://ns.inria.fr/kg/index#>
            CONSTRUCT {
                $datasetDescription void:propertyPartition [
                        void:property ?p ;
                        void:distinctSubjects ?x
                    ]
            } WHERE {
                { SELECT (COUNT(DISTINCT ?s) AS ?x) ?p WHERE { ?s ?p ?o } GROUP BY ?p }
            }"""
        ]
        <../meta/modifiedUpdate.ttl>
    ) .

<sportalPropertyPartitionDistinctObject.ttl> a mf:ManifestEntry ;
    kgi:onSuccess (
        [
            mf:action """PREFIX void: <http://rdfs.org/ns/void#>
            PREFIX kgi: <http://ns.inria.fr/kg/index#>
            CONSTRUCT {
                $datasetDescription void:propertyPartition [
                        void:property ?p ;
                        void:distinctObjects ?x
                    ]
            } WHERE {
                { SELECT (COUNT(DISTINCT ?o) AS ?x) ?p WHERE { ?s ?p ?o } GROUP BY ?p }
            }"""
        ]
        <../meta/modifiedUpdate.ttl>
    ) .

# Miscanellous statistics from SPORTAL using a vocabulary created for SPORTAL only
#    mf:action """PREFIX voidex: <http://ldf.fi/void-ext#>
#        CONSTRUCT { $datasetDescription void:propertyPartition [ void:property ?p ; s:subjectTypes [ s:subjectClass ?sType ; s:distinctMembers ?x ] ] } WHERE { SELECT (COUNT(?s) AS ?x) ?p ?sType WHERE { ?s ?p ?o ; a ?sType . } GROUP BY ?p ?sType } """ ;
#    mf:action """PREFIX voidex: <http://ldf.fi/void-ext#>
#        CONSTRUCT { $datasetDescription void:propertyPartition [ void:property ?p ; s:objectTypes [ s:objectClass ?oType ; s:distinctMembers ?x ] ] } WHERE { SELECT (COUNT(?o) AS ?x) ?p ?oType WHERE { ?s ?p ?o . ?o a ?oType . } GROUP BY ?p ?oType } """ ;
